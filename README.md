# ir-spybotics

LEGO MINDSTORMS Spybotics had an infrared remote control. This protocol, based on a 76 kHz carrier, was also used on Bionicle Technic Manas, RC Nitro Flash, DUPLO RC Dozer and RC Train. It had a short lifespan and was replaced by LEGO Power Functions IR protocol, based on a 38 kHz carrier, still in use.

'ir_generate.py' is a python script that generates the signals to control this devices. The output can be used with Arduino with IRLib2 library, like the example sketch 'rawSend'.


'all_commands.txt' contains all commands generated by the script.

A typical command is shown:

```
Command: Ch1_OrangeNop_YellowFwd
  Msg:     00000101011100010111011
  Size:    12
  Signal:  1040, 208, 208, 208, 208, 624, 624, 208, 208, 624, 208, 624
  ```
  
This is the command sent by the Remote Control when just the Yellow Forward button is pressed (since Spybotics command doesn't have collors we could also say Right Forward button).

It contains 12 transitions and the timings before each transition occurs. Since transmission always start with a '0', the signal consists in a '0' for 1040 us, followed by a '1' for 208 us, then another '0' for 208 us, etc.

To use this command with 'rawSend' we should include this definition:

```
#define Ch1_OrangeNop_YellowFwd_LEN 12
uint16_t Ch1_OrangeNop_YellowFwd[Ch1_OrangeNop_YellowFwd_LEN]={
  1040, 208, 208, 208, 208, 624, 624, 208, 208, 624, 208, 624
  };
```

Then to send the command we use:

```
mySender.send(Ch1_OrangeNop_YellowFwd,Ch1_OrangeNop_YellowFwd,76);
```

More details about my findings here:
http://ofalcao.pt/blog/2017/decoding-old-lego-infrared-protocol


## Example

'RemoteControl.ino' is an extended version of 'rawSend', it includes all signals generated with 'ir_generate.py' and accepts commands from the serial port so we can control a LEGO device with a computer.

It's configured to use All Channels and reacts to 4 keys moving both motors at the same time:
    'F': Front
    'B': Back
    'L': Turn Left
    'R': Turn Right
    
It also reacts to keys '0', '1', '2' and '3', making turns with just one motor (instead of using both)

In linux you can use it with 'screen' like this:
```
screen /dev/ttyACM0
```
or you can send commands from bash like this
```
echo F > /dev/ttyACM0
```
but you might need to set tty device with:
```
stty -F /dev/ttyACM0 ispeed 9600 ospeed 9600 -ignpar cs8 -cstopb -echo
```
